<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="14.0">

  <Target Name="OnTestFailure">
    <CallTarget Targets="AfterRunTests;CopyTrxFile;MarkBuildStepAsFailed"/>
  </Target>

  <Target Name="AfterRunTests"
    AfterTargets="RunTests">

    <RemoveDir Directories="$(BinTestDirectory)Dependencies"
      ContinueOnError="true"  />
    <RemoveDir Directories="$(BinTestDirectory)ModuleBin"
      ContinueOnError="true" />
    <RemoveDir Directories="$(BinTestDirectory)TestResults\packages"
      ContinueOnError="true" />

    <Delete Condition="'@(TestAssemblyConfigFiles)' != ''"
      Files="@(TestAssemblyConfigFiles)"
      TreatErrorsAsWarnings="true" />
  </Target>


  <Target Name="CopyTrxFile" AfterTargets="RunTests">
    <!--<ItemGroup>
      <TestResults Include="$(SolutionDirectoryPath)**\*.trx" />
    </ItemGroup>

    <Copy Condition="@(TestResults) != ''"
          SourceFiles="@(TestResults)"
          DestinationFiles="$(BinTestDirectory)TestResults.trx" />-->
  </Target>

  <!--
    ==========================================================================================
        MarkBuildStepAsFailed
    ==========================================================================================
  -->
  <Target Name="MarkBuildStepAsFailed"
    Condition="'$(IsDesktopBuild)' != 'true' And '$(IsCustomBuild)' != 'true'">
    <Message Text="Marking build as failed" />

  </Target>

</Project>