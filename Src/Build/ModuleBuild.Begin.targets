<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003"
         DefaultTargets="BeforeModuleBuild"
         ToolsVersion="14.0">
         
         
  <Import Project="$(DirectoryBuildFile)" />
  <Import Project="Aderant.Build.Common.targets" />
  <Import Project="RM.TransformTemplates.Targets" />
  <Import Project="Aderant.TextTransform.targets" />


  <!-- 
    ==========================================================================================
        Build Configurations
    ==========================================================================================
  -->
  <!--<ItemGroup>
    <ConfigurationToBuild
      Condition="'$(BuildFlavor)' == 'Release'"
      Include="Release|AnyCPU">
      <FlavorToBuild>Release</FlavorToBuild>
      <PlatformToBuild>AnyCPU</PlatformToBuild>
    </ConfigurationToBuild>
    <ConfigurationToBuild
      Condition="'$(BuildFlavor)' == '' Or '$(BuildFlavor)' == 'Debug'"
      Include="Debug|AnyCPU">
      <FlavorToBuild>Debug</FlavorToBuild>
      <PlatformToBuild>AnyCPU</PlatformToBuild>
    </ConfigurationToBuild>
  </ItemGroup>-->
         
  <Target Name="BeforeModuleBuild">
         
         
         <!-- <Message Text="MSBuildNodeCount: $(MSBuildNodeCount)"/>
         
         
         -->
<!-- <Message Text="MSBuildExtensionsPath32: $(MSBuildExtensionsPath32)"/> -->
<!-- <Message Text="MSBuildProjectDirectoryNoRoot: $(MSBuildProjectDirectoryNoRoot)"/> -->
<!-- <Message Text="MSBuildToolsPath: $(MSBuildToolsPath)"/> -->
<!-- <Message Text="MSBuildToolsVersion: $(MSBuildToolsVersion)"/> -->
<!-- <Message Text="MSBuildBinPath: $(MSBuildBinPath)"/> -->
<!-- <Message Text="MSBuildExtensionsPath: $(MSBuildExtensionsPath)"/> -->
<!-- <Message Text="MSBuildProjectDefaultTargets: $(MSBuildProjectDefaultTargets)"/> -->
<!-- <Message Text="MSBuildProjectDirectory: $(MSBuildProjectDirectory)"/>  -->
<!-- <Message Text="MSBuildProjectExtension: $(MSBuildProjectExtension)"/> -->
<!-- <Message Text="MSBuildProjectFile: $(MSBuildProjectFile)"/> -->
<!-- <Message Text="MSBuildProjectFullPath: $(MSBuildProjectFullPath)"/> -->
<!-- <Message Text="MSBuildProjectName: $(MSBuildProjectName)"/> -->
<!-- <Message Text="MSBuildStartupDirectory: $(MSBuildStartupDirectory)"/> -->

        <Message Text="DirectoryBuildFile: $(DirectoryBuildFile)"/> 
        
    <ItemGroup>
      <BuildGroup Include="@(Build->WithMetadataValue('BuildGroup', '$(BuildGroup)'))" />
    </ItemGroup>
    

    <Error Condition="'$(CustomAfterMicrosoftCSharpTargets)' == '' And '$(IsCustomBuild)' != 'true'" Text="No custom CSharp targets file set" />
    <Error Condition="'$(CustomAfterMicrosoftCommonTargets)' == '' And '$(IsCustomBuild)' != 'true'" Text="No custom Microsoft common targets file set" />

    <!--<PropertyGroup>
      <IsWebModule>false</IsWebModule>
      <IsWebModule Condition="$(ModuleName.Contains('Web.')) Or '$(PackageWeb)' == 'true'">true</IsWebModule>
      <ExternalConstants Condition="'$(IsCustomBuild)' == 'true'">IS_CUSTOM_BUILD</ExternalConstants>
    </PropertyGroup>-->

    <PropertyGroup>
      <AssemblyDebugOptions>
        DebugSymbols=true;
        DebugType=full;
        Optimize=true
      </AssemblyDebugOptions>
    </PropertyGroup>

    <PropertyGroup>
      <BuildProperties>
        BuildToolsDirectory=$(BuildToolsDirectory);
        BuildScriptsDirectory=$(BuildScriptsDirectory);
        CustomAfterMicrosoftCSharpTargets=$(CustomAfterMicrosoftCSharpTargets);
        CustomAfterMicrosoftCommonTargets=$(CustomAfterMicrosoftCommonTargets);
        AlternativeOutputDirectory=$(SharedDependencyDirectory);
        RunCodeAnalysis=false;
        ShouldUnsetParentConfigurationAndPlatform=true;
        BuildProjectReferences=false<!--;
        $(AssemblyDebugOptions)-->
      </BuildProperties>
    </PropertyGroup>

    <!--
        ShouldUnsetParentConfigurationAndPlatform
        Ensures that x86 projects with a P2P reference to an AnyCPU project don't push the x86 configuration/platform into the P2P reference and trigger
        a missing configuration/platform error.
    -->

<Message Text="
╔═════════════════════════════════════════════════════════════════════╗
║                     Group Start $(BuildGroup.PadRight(4)) / $(TotalNumberOfBuildGroups.PadRight(4))                         ║           
╚═════════════════════════════════════════════════════════════════════╝
" Importance="high"></Message>



    <ItemGroup>
      <ProjectsToBuild Include="@(BuildGroup)" Condition="%(BuildGroup.IsWebProject) == 'true'">
        <Properties>$(BuildProperties);PackageWeb=true</Properties>
      </ProjectsToBuild>

      <ProjectsToBuild Include="@(BuildGroup)" Condition="%(BuildGroup.IsWebProject) != 'true'">
        <Properties>$(BuildProperties)</Properties>
      </ProjectsToBuild>
    </ItemGroup>

    <Message Text="BuildGroup=@(BuildGroup)"/>
    <Message Text="BuildProperties=@(BuildProperties)"/>

    <MSBuild Projects="@(ProjectsToBuild)" Targets="Build" BuildInParallel="true" Properties="%(ProjectsToBuild.Properties)" />
    
  </Target>


  <PropertyGroup>
    <PrepareModuleForBuildDependsOn>
      ModuleEnter;
      rmTransformTemplates;
    </PrepareModuleForBuildDependsOn>
  </PropertyGroup>


  <PropertyGroup>
    <BinTestDirectory>$(SolutionDirectoryPath)Bin\Test\</BinTestDirectory>
    <BinModuleDirectory>$(SolutionDirectoryPath)Bin\Module\</BinModuleDirectory>
    <ModuleSourceDirectory>$(SolutionDirectoryPath)Src\</ModuleSourceDirectory>
    <ModuleTestDirectory>$(SolutionDirectoryPath)Test\</ModuleTestDirectory>
    <ModuleBuildDirectory>$(SolutionDirectoryPath)Build\</ModuleBuildDirectory>
    <DependenciesDirectory>$(SolutionDirectoryPath)Dependencies</DependenciesDirectory>
    <ModuleBuildTempDirectory Condition="'$(ModuleBuildTempDirectory)' == ''">$(SolutionDirectoryPath)BuildTemp\</ModuleBuildTempDirectory>
    <rmBCItemTransformTemplatesEnabled>$(T4TransformEnabled)</rmBCItemTransformTemplatesEnabled>
  </PropertyGroup>


  <Target Name="ModuleEnter">
    <Message Text="
╔═════════════════════════════════════════════════════════════════════╗
║                     $(ModuleName.PadRight(20))                    ║
╚═════════════════════════════════════════════════════════════════════╝
" Importance="high"></Message>
  </Target>


  <Target Name="Build" DependsOnTargets="$(PrepareModuleForBuildDependsOn)">
    <Message Text="SolutionDirectoryPath: $(SolutionDirectoryPath)" />
    <Message Text="T4TransformEnabled:    $(T4TransformEnabled)" />
    <Message Text="ZipCustomSource:       $(ZipCustomSource)" />
    <Message Text="VersionMajor:          $(VersionMajor)" />
    <Message Text="VersionMinor:          $(VersionMinor)" />
    <Message Text="VersionBuild:          $(VersionBuild)" />
    <Message Text="VersionRevision:       $(VersionRevision)" />


    <ItemGroup>
      <DirProject Include="$(MSBuildThisFileDirectory)\dir.proj;$(MSBuildThisFileDirectory)\Aderant.wpp.content.proj;$(MSBuildThisFileDirectory)\Aderant.wpp.content.v2.proj" />
    </ItemGroup>

    <Copy SourceFiles="@(DirProject)"
      DestinationFolder="$(SolutionRoot)"
      UseHardlinksIfPossible="true"
      OverwriteReadOnlyFiles="true"
      SkipUnchangedFiles="true" />

  </Target>

  <Target Name="Clean"/>
         
         

  
</Project>
