<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003"
         DefaultTargets="DispatchToInnerBuild"
         ToolsVersion="14.0">
         
  <!-- 
  This project file exists to provide an appropriate seam for adding new properties to the group without having to 
  modify the project generator itself.
  -->
  <Target Name="DispatchToInnerBuild" DependsOnTargets="GetBuildGroupProjects">

    <MSBuild Projects="ComboBuild.BeforeBuild.targets"
             Targets="GetBuildGroupProjects"
             BuildInParallel="$(BuildInParallel)"
             Properties="InstanceProjectFile=$(InstanceProjectFile);BuildGroup=$(BuildGroup)">
      <!--The compiled assemblies from projects-->
      <Output ItemName="CompiledAssemblies"
              TaskParameter="TargetOutputs" />
    </MSBuild>

  </Target>
  
  
  <Target Name="GetBuildGroupProjects" Returns="@(ProjectsInGroup)">
    <!-- From the generated project, find projects we should build in this group. -->
    <ItemGroup>
      <ProjectsInGroup Include="@(ProjectsToBuild->WithMetadataValue('BuildGroup', '$(BuildGroup)'))" /> 
    </ItemGroup>

  </Target>

</Project>