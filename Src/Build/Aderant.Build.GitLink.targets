<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" 
         ToolsVersion="14.0">

  <Target Name="ApplyGitLink" Condition="'$(IsDesktopBuild)' != 'true'" >
    
    <ItemGroup>
      <PDBFiles Include="$(BinModuleDirectory)\*.pdb" />
    </ItemGroup>
    
    <PropertyGroup>
        <url>http://tfs/aderant/ExpertSuite/_apis/git/repositories/$(BUILD_REPOSITORY_NAME)/{revision}/{filename}</url> <!-- to be rewritten to http://tfs:8080/aderant/ExpertSuite/_apis/git/repositories/Deployment/items?path={filename}&versionType=commit&version={revision} -->
    </PropertyGroup>

    <Message Text="Found PDB files:"/>
    <Message Text="%(PDBFiles.FullPath)" />
    <Message Text="ModuleName=$(ModuleName)"/>
    <Message Text="BUILD_REPOSITORY_NAME=$(BUILD_REPOSITORY_NAME)"/>

    <!-- For empty dlls the tool will fail with exit code 1 and message: No source files were found in the PDB. If you're PDB is a native one you should use -a option.
         Just ignore for convenience.
         See bug 197745. -->
    <Exec ContinueOnError="true"
      IgnoreExitCode="true"
      Command="$(BuildToolsDirectory)GitLink\GitLink.exe %(PDBFiles.FullPath) -u $(url)"/>
    
  </Target>
  
</Project>

