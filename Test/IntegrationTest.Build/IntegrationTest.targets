<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="Aderant.Build.Common.targets" />

  <ItemGroup>
    <Files Include="*.dll;" />
  </ItemGroup>

  <Target Name="GetAssembliesWithTraits">
    <GetAssembliesWithTraits CompanyName="Aderant" Files="@(Files)" />
  </Target>


  <Target Name="CheckCertificate">
    <CheckCertificate Thumbprint="1c2a3e8f5e969fd0a526f917100f6231faacb460" />
  </Target>

  <Target Name="GetFileVersionInfo">
    <ItemGroup>
      <MSI Include="C:\Windows\Installer\**\*.msi" />
    </ItemGroup>
    <GetFileVersionInfo Files="@(MSI)" />
  </Target>
  
  <Target Name="GitVersion">
    <GitVersion WorkingDirectory="$(MSBuildProjectDirectory)" Discover="true">
      <Output PropertyName="GitCanonicalBranchName" TaskParameter="CanonicalBranchName" />
      <Output PropertyName="GitSha" TaskParameter="Sha" />
      <Output PropertyName="GitCommit" TaskParameter="Commit" />
      <Output PropertyName="GitFriendlyBranchName" TaskParameter="FriendlyBranchName" />
    </GitVersion>

    <Message Text="$(GitBranchFriendlyName)" />
    <Message Text="$(GitCanonicalBranchName)" />
    <Message Text="$(GitSha)" />
    <Message Text="$(GitCommit)" />
  </Target>

  <Target Name="RunAnalyzer">
    <MSBuild Projects="Resources\RunAnalyzerTest.csproj" />
  </Target>

  <Target Name="ReadAssemblyInfo">
    <ReadAssemblyInfo AssemblyInfoFiles="AssemblyInfo.cs">
      <Output ItemName="AssemblyInformationalVersion" TaskParameter="AssemblyInformationalVersion" /> 
      <Output ItemName="AssemblyVersion" TaskParameter="AssemblyVersion" />
      <Output ItemName="AssemblyFileVersion" TaskParameter="AssemblyFileVersion" />
    </ReadAssemblyInfo>
    <Message Text="%(AssemblyInformationalVersion.Major)" />
  </Target>

  <Target Name="CopyToDropV2">
    <PropertyGroup>
      <YieldDuringCopy>false</YieldDuringCopy>
    </PropertyGroup>

    <Exec ContinueOnError="false"
      IgnoreExitCode="false"
      Command='"Powershell" -noprofile -ExecutionPolicy RemoteSigned "$(BuildInfrastructureDirectory)\Src\Build\CopyToDropV2.ps1" -dropRoot &#39;$(DropRoot)&#39; -moduleName &#39;$(ModuleName)&#39; -moduleRootPath &#39;$(BuildInfrastructureDirectory)\Test\IntegrationTest.Build\Resources\TestModule&#39; -origin &#39;$(Origin)&#39; -version &#39;$(BuildNumber)&#39; -generateFile $(GenerateFile)'
      YieldDuringToolExecution="$(YieldDuringCopy)" />
  </Target>

</Project>
